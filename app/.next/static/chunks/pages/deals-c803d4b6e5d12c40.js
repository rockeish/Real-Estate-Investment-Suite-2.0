(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[901],{2394:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/deals",function(){return s(6364)}])},6364:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(4246),n=s(7378),l=s(3473);let d=s(4284).env.NEXT_PUBLIC_API_BASE||"http://localhost:5000/api";function i(e){let{deal:t,onSave:s,onCancel:l}=e,[i,r]=(0,n.useState)(t||{}),c=async e=>{e.preventDefault();let a=t?"".concat(d,"/deals/").concat(t.id):"".concat(d,"/deals");try{let e=await fetch(a,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok)throw Error("Failed to save deal");let n=await e.json();s(n)}catch(e){console.error(e)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:t?"Edit Deal":"Add New Deal"}),(0,a.jsxs)("form",{onSubmit:c,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium",children:"Address"}),(0,a.jsx)("input",{type:"text",name:"address",id:"address",value:i.address||"",onChange:e=>{let{name:t,value:s}=e.target;r(e=>({...e,[t]:s}))},className:"w-full px-3 py-2 border rounded-md",required:!0})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{type:"button",onClick:l,className:"px-4 py-2 bg-gray-200 rounded-md",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:t?"Save Changes":"Add Deal"})]})]})]})})}let r={Lead:{name:"Lead",items:[]},Analyzing:{name:"Analyzing",items:[]},"Offer Made":{name:"Offer Made",items:[]},"Under Contract":{name:"Under Contract",items:[]},Closed:{name:"Closed",items:[]},Lost:{name:"Lost",items:[]}};function c(e){let{deal:t,index:s,onEdit:n}=e;return(0,a.jsx)(l._l,{draggableId:String(t.id),index:s,children:(e,s)=>(0,a.jsxs)("div",{ref:e.innerRef,...e.draggableProps,...e.dragHandleProps,className:"p-3 mb-3 bg-white rounded-lg shadow ".concat(s.isDragging?"bg-slate-100":""),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:t.address}),(0,a.jsxs)("p",{className:"text-sm text-slate-600",children:[t.city,", ",t.state]})]}),(0,a.jsx)("button",{onClick:()=>n(t),className:"text-sm text-blue-600 hover:underline",children:"Edit"})]}),(0,a.jsx)("p",{className:"text-sm text-slate-500 mt-2",children:t.list_price?"List: ".concat(new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t.list_price)):"Price not set"})]})},t.id)}function o(){let[e,t]=(0,n.useState)(r),[s,d]=(0,n.useState)(!0),[o,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(!1),[p,x]=(0,n.useState)(null),f=async()=>{try{d(!0);let e=await fetch("/api/deals");if(!e.ok)throw Error("Failed: ".concat(e.status));let s=await e.json(),a=JSON.parse(JSON.stringify(r));s.forEach(e=>{a[e.status]&&a[e.status].items.push(e)}),t(a)}catch(e){u(e.message)}finally{d(!1)}};(0,n.useEffect)(()=>{f()},[]);let b=async s=>{if(!s.destination)return;let{source:a,destination:n}=s,l={...e},d=l[a.droppableId],i=l[n.droppableId],[r]=d.items.splice(a.index,1);if(a.droppableId!==n.droppableId){i.items.splice(n.index,0,r),t(l);try{await fetch("/api/deals/".concat(r.id,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:n.droppableId})})}catch(e){console.error("Failed to update deal status",e),f()}}else d.items.splice(n.index,0,r),t(l)},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;x(e),h(!0)},j=()=>{x(null),h(!1)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Deal Funnel"}),(0,a.jsx)("button",{onClick:()=>g(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Deal"})]}),m&&(0,a.jsx)(i,{deal:p,onSave:()=>{f(),j()},onCancel:j}),s&&(0,a.jsx)("div",{children:"Loadingâ€¦"}),o&&(0,a.jsx)("div",{className:"text-red-600",children:o}),!s&&!o&&(0,a.jsx)("div",{className:"flex gap-4 overflow-x-auto",children:(0,a.jsx)(l.Z5,{onDragEnd:b,children:Object.entries(e).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"w-80 bg-slate-100 rounded-lg p-3",children:[(0,a.jsx)("h2",{className:"font-semibold mb-3",children:s.name}),(0,a.jsx)(l.bK,{droppableId:t,children:(e,t)=>(0,a.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"min-h-96 ".concat(t.isDraggingOver?"bg-slate-200":""),children:[s.items.map((e,t)=>(0,a.jsx)(c,{deal:e,index:t,onEdit:g},e.id)),e.placeholder]})},t)]},t)})})})]})}}},function(e){e.O(0,[143,877,888,774,179],function(){return e(e.s=2394)}),_N_E=e.O()}]);